{% extends 'base.html' %}

{% block title %}Pomo Progress{% endblock %}

{% block header %}
<header>
    <!-- figure out how to make logout and logo on the same line -->
    <a href="/">logout</a>
    <center>
        <h1>Pomo Progress!</h1>
    </center>
</header>
{% endblock %}

{% block main %}
<center>
    <form action="/home" method="post">
        Pomodoros:
        <input name="tomatoes" placeholder="pomodoro count" type="number" required>
        Task:
        <input name="task" placeholder="primary task" type="text">
        Notes:
        <input name="notes" placeholder="notes or secondary tasks" type="text">
        <input type="submit">
    </form>
</center>
    <hr>
<div class="row">
    <div class="column left">
            <center>
            <u><strong>About Table</strong></u>
            <br>
            <br>
            "{{ session['table_name'] }}"
            <br>
            <br>
            <strong>Purpose:</strong> 
            <br>
            {{ session['purpose'] }}
            <br>
            <br>
            <strong>Hourly Goal:</strong> {{ session['hours_goal'] }} hours
            <br>
            <br>
            <strong>Time Frame:</strong><br>{{ session['years'] }} years {{ session['months']}} months {{ session['days'] }} days
            <br>
            <strong>[CONVERT TO DEADLINE SYSTEM]</strong>
            <br>
            <br>
            <strong>Pomodoro Time:</strong> {{ session['tomato_rate'] }} minutes
            <br>
            </center>
    </div>
    <div class="column middle">
        <center>
        <table id="pomodoro_data" style="display: inline-block;">
            <th>Date</th>
            <th>Pomodoros</th>
            <th>Task(s)</th>
            <th>Notes</th>
            <tr>
                {% if day_count > 0 %}
                    <td class="week">#{{ week_count + 1 }}</td>
                    <td class="week">Total: {{ tomato_total }}</td>
                    <td class="week" colspan="2">Avg: {{ (tomato_total/day_count)|round(2, 'floor') }}</td>
                {% endif %}
                {% if day_count == 0 %}
                    <!--if it has been exactly a week, do not display anything for upcoming week-->
                {% endif %}
            </tr>
            {% for row in full_chart|reverse %}
                <tr>
                    {% if row['date']|float >= 1 %}
                        <td class="week">#{{ row['date'] }}</td>
                        <td class="week">Total: {{ row['tomato_count'] }}</td>
                        <td class="week" colspan="2">Avg: {{ row['task'] }}</td>
                    {% else %}
                        {% if row['tomato_count']|int >= 10 %}    
                            <td>{{ row['date'] }}</td>
                            <td class="pomos10">{{ row['tomato_count'] }}</td>
                            {% if row['task'] != None and row['task'] != "" %}
                                <td>{{ row['task'] }}</td>
                            {% else %}
                                <td>-</td>
                            {% endif %}                            
                            {% if row['notes'] != None and row['notes'] != "" %}
                                <td class="notes"><a href="/notes">notes</a></td>
                            {% else %}
                                <td>-</td>   
                            {% endif %}
                        {% else %}
                            <td>{{ row['date'] }}</td>
                            <td class="pomos">{{ row['tomato_count'] }}</td>
                            {% if row['task'] != None and row['task'] != "" %}
                                <td>{{ row['task'] }}</td>
                            {% else %}
                                <td>-</td>
                            {% endif %}   
                            {% if row['notes'] != None and row['notes'] != "" %}
                                <td class="notes"><a href="/notes">notes</a></td>
                            {% else %}
                                <td>-</td>   
                            {% endif %}
                        {% endif %}
                    {% endif %}
                </tr>
            {% endfor %}
        </table>
        </center>
    </div>
    <div class="column right">
        <details>
            <summary>Stats</summary>
            <br>
            <center>
                <strong>Total Pomodoros:</strong> {{ stats['total_tomatoes'] }}
                <br>
                <strong>Daily Average:</strong> {{ stats['daily_average'] }}
                <br>
                <strong>Pomodoros to Goal:</strong> {{ stats['pomos_left'] }}
                <br>
                <strong>Pace:</strong>  
                    {% if stats['pace']['rate'] >= 100 %}
                        <span style="color:rgb(17, 175, 17)"><strong> ~{{ stats['pace']['rate'] }}%</strong> {{ stats['pace']['on_pace'] }}</span>
                    {% else %}
                        <span style="color: red"><strong> ~{{ stats['pace']['rate'] }}%</strong> {{ stats['pace']['on_pace'] }}</span>  
                    {% endif %}
                <br>
                <br>
                <strong>Current Streak:</strong> {{ stats['days_in_a_row'] }} days
                <br>
                <strong>One Day Record:</strong> {{ stats['one_day_high']}}
            </center>
        </details>
    </div>
<div>
{% endblock %}